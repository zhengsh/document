# 系统架构

## 软件架构概念

架构将设计就是需求分配，即将满足需求的职责分配到组件上。
软件架构需求过程主要是获取用户需求，标识系统中所要用到的构件，并进行架构需求评审。其中，
标识构建有详细地分为：生成类图、对类图进行分组和将类图打包成构件3个步骤。

### 软件架构概念-软件架构模型

* 逻辑视图 （**功能**）
  最终用户：功能需求 （UML: 逻辑视图）
  
* 开发视图 (**源代码结构**)
  编程人员：软件管理（URL：实现视图）

* 进程视图 （**并发**）
  系统集成人员：性能可拓充性，吞吐量等（URL：进程视图）

* 物理视图 （**软件与硬件之间的映射**）
  系统工程人员：系统拓扑，安装，通讯等（URL：部署视图）
 
* 场景 （UML: 用例视图）


## 架构描述语言（ADL）

体系描述语言（architecture description language, 简称 ADL），支持：构件、连接子及其配置的描述语言。

## 软件架构风格

* 数据流风格（ETL）：
**典型特征：对数据进行处理分阶段、请一个阶段的结果，作为下一个阶段的输入**
  批处理序列(**数据必须是完整的，以整体的方式传递**)，
  管道-过滤器(**早期编译器就是采用这种架构，要一步一步处理的，均可考虑采用此架构风格**)
    * Unix shell 程序，提供一种符号连接各组成部分，雨哦提供某种进程运行时机制来实现管道
区别：批处理强调数据必须完整。

* 调用/返回风格：（MVC 、 C/S、 B/S、网络七层模型）
  * 主程序/子程序
  * 面向对象
  * 层次结构
  
* 独立构件风格：进程通讯、事件驱动系统（隐式调用）

* 虚拟机风格：解释器、基于规则的系统

* 仓库风格(**以数据为中心**)：数据库系统、超文本系统、黑板系统

### 软件架构风格-数据流风格 （用户交互方面更弱）
* 批处理序列 （**早期的编译器**）
  **对数据库惊醒处理，并分阶段，前一阶段的结果，作为本步骤的输入** 
  数据必须**完整**的，以整体的方式传输。
  
* 管道-过滤器 （**早期的编译器**）
  早起编译器就是采用这种风格，要一步一步的处理，均可考虑采用此架构风格。

### 软件架构风格-调用/返回风格

* 主程序/子程序
* 面向对象
* 层次结构
  构件组织成一个层次结构，连接件通过决定层间如何交互的协议来定义。每层为上一层提供服务，
使用下一层的服务，只能看到自己临接的层。通过层次结构，可以将大的问题分解为若干个逐渐的小问题逐步解决，
可以隐藏问题的复杂度，修改某一层，最多影响其相邻的两层（通常只能影响上层）

#### 层次结构
优点
* 这种风格支持基于可增加抽象层的设计，将一个复杂问题分解成一个增量步骤序列的实现

### 独立构件风格

#### 进程通讯
  远程或者一部调用等

#### 事件驱动系统（隐式调用）
按钮控件。断点调试，编辑器

### 软件架构风格-虚拟机风格 （**关键字：自定义**）
  有没有需要自定义业务流程的场景，如：游戏自定义地图，OA自定义审批流程
  
* 解释器（任务持续依赖，动态调整）
  解释器通常包括一个完成解释工作的解释引擎，一个包含将被解释的代码的存储区、
一个记录引擎当前工作状态的数据结构，以及记录一个源代码被解释执行的进度的数据结构。具有解释器风格的软件
中含有一个虚拟机，可以仿真的执行过程和一些关键应用，其确定是执行效率比较低

* 基于规则的系统 （**人工智能和DSS**）
  基于规则的系统包括规则集、规则解释器、规则/数据选择器和工作内存，一般用在人工智能领域的DSS中。
  知识性质：通过历史数据进行大量分析，产生一些对决策有帮助的条款与规则。

#### 软件架构风格-仓库风格（以数据为中心的风格/数据共享风格）
* 数据库系统（DBMS）
  构件主要有两大类，一类是共享数据源，保存当前系统的数据状态；另一类是多个独立处理单元，处理单元对数据元素进行操作
  中心一个数据源，其他应用系统协作处理

* 黑板系统
  信号处理、问题规划（例子：语音处理）
  
* 超文本系统
  现代集成编译环境一般采用这种架构风格 隐式调用（事件驱动）
  
  
#### 软件架构风格-闭环控制架构（过程控制）

适合于嵌入式系统，涉及连续的动作状态

### 练习题目：
  1、Java 程序 "一次编写、处处运行" **虚拟机**
  2、网络中进行包的计息，先分包头，然年后进行报文解析以及后续处理 **数据流**
  3、联动机制， **隐式调用**
  4、自定义地图 **解释器**
  5、空调自动调节温度  **过程控制**
  6、语音识别系统 **黑板**
  7、漫步者机器人 **隐式调用**
  8、编译器。代码作为一个真题，依在不同的模块中传递 **顺序批处理**
  9、现代开发环境 工具间的相互 **数据共享**
  10、修改代码后，语法高亮。错误提示、程序结构更新 **隐式调用**
  11、生成符合新操作系统的代码， 功能不变接口形式发生变化 **适配**
  12、模拟操作系统 采用 ** 虚拟机**
  

### 软件架构风格-层次架构风格

两层 (C/S)=> 三层 (C/S) => 三层 (B/S) => 混合架构 


#### 软件架构风格-层次架构风格

* 三层B/S
  * 表现层
    * MVC （在表示层级）
    * MVP
    * MVVM
   * 中间层
   * 数据访问层
     * ORM
   * 数据架构层

##### 软件架构风格-MVC架构风格

* Model (模型)是应用程序中用于**处理应用程序数据逻辑的部分**。通常模型对象负责在数据库中存储数据。

* View （视图）是应用程序中**处理数据显示的部分**。通常视图是依据模型数据的创建的。

* Controller (控制器) 是应用程序中**处理用户交互的部分**。通常控制器负责从视图读取数据，
控制用户输入，并向模型发送数据。

* J2EE体系结构中

  视图（View）JSP
  控制（Controller）Servlet
  模型（Model）Entity Bean, Session Bean

严格分层，只能相邻的层次之间通讯、非严格分层，跨层交换信息。

* 主动MVC

* 被动MVC 


##### 软件架构风格-MVP架构风格

##### 软件架构风格-MVVM架构风格

##### 软件架构风格-富互联网应用（RIX）

B/S 表现能力比较差
B/S 零客户端
富客户端
如：flex, html5, Bindows

##### 软件架构风格-基于服务的架构（SOA）

服务是一种为了满足某项业务需求的操作、规则等的逻辑组合，它包含一系列有序活动的交互
，为实现用户目标提供支持

服务是一种标准化程度更高的构件

##### SOA - 关键技术

* 服务发现
  * UDDI、DISCO
* 描述服务
  * WSDL、XML Schema
* 消息格式层
  * SOAP REST
* 编码格式层
  * XML （DOM，SAX）
* 传输协议层
  * HTTP、TCP/IP、SMTP 等


实现SOA：两大技术
Web 服务 （web service）
ESB   企业服务总线

* SOA - 实现方式 Web Service 
  * 服务请求者
  * 服务注册中心 (服务描述) （百度搜索引擎）
  * 服务提供者

软考考生 => 希赛网 (静态绑定)
  * 底层传输层
  * 服务通信协议层
  * 服务描述层
  * 服务层
  * 业务流程
  * 服务注册层
  

###### SOA - 关键技术- XML

###### SOA - 关键技术- REST

###### SOA - 关键技术- WSDL
  用来做服务的定义
  
###### SOA - 关键技术- ESB
  消息中间件
  服务总线 （中介模式）
  
  它是面向服务的架构（SOA）的一种
  实现方式

ESB 是总线， web service 是单个节点

##### SOA - 服务注册表


#### 软件架构风格 - 微服务

* 特点
  * 小、且专注于做一件事情
  * 轻量级的通信机制
  * 松耦合、独立部署
    * 容器技术来实现快速部署 docker , k8s
    * 自动集成 jenkins 来做 ci/cd
    
* 优势
  * 技术异构性
  * 弹性
  * 拓展
  * 简化部署
  * 与组织结构相匹配
  * 可组合性
  * 对可替代性的优化
  
* 挑战
  * 分布式系统的复杂度
  * 运维成本
  * 部署自动化
  * DevOps与组织结构
  * 服务间依赖测试
  * 服务间依赖管理

#### 软件架构风格 - 微服务与SOA

|  微服务 | SOA | 
| :------| :------ | 
| 能拆分就拆分   | 是整体的，服务能放在一起的就放在一起 | 
| 纵向业务划分   | 是水平分多层 |
| 由单一组织负责 | 按层级划分不同部分的组织 |
| 细粒度        | 粗粒度 |
| 两句话就可以解释明白 | 几百字相当于SOA的目录 |
| 独立的子公司 | 类似大公司里面划分了一些业务单元（BU） |
| 组件小 | 存在较复杂的组件 |
| 业务逻辑存在于每一个服务中 | 业务逻辑横跨多个业务领域 |
| 使用轻量级的通讯方式，如HTTP | 企业服务总线（ESB从当了服务之间通讯的角色） |

设计类：实体类，边界类，控制类

|  微服务架构实现 | SOA实现 | 
| :------| :------ | 
| 团队级，自底向上开展实施   | 企业级，自顶向下开展实施 | 
| 一个系统被拆分为多个服务，粒度细   | 服务由多个子系统组成，粒度大 |
| 无集中式总线，松散的服务架构 | 企业服务总线，集中式的服务架构 |
| 集成方式简单（HTTP/REST/JSON）        | 集成方式复杂（ESB/WS/SOAP） |
| 服务能独立部署 | 单块架构系统，互相依赖，部署复杂 |


#### 基于架构的软件开发方法-开发过程
* 架构需求
* 架构设计
* 架构文档化
* 架构复审
  * 
  
* 架构实现
* 架构演化

* 架构需求过程
  * 需求获取
  * 生成类图
  * 对类进行分组
  * 把类打包成构件
  * 需求评审
  
* 架构设计过程
  * 提出架构模型
  * 映射构件
  * 分析构件相互作用
  * 生产架构
  * 设计评审

##### 软件架构评估（必考）

* 为什么要进行架构评估？
* 架构评估到底评什么？
* 架构评估怎么评？

###### 质量属性 （非功能设计）

出现数字一般考虑非功能性
* 6个质量属性：可用性，可修改性、性能、安全性、可测试行、易用性
* 质量属性场景是一种面向特定质量的需求，由6部分组成：刺激源、刺激、环境、制品、响应、响应度量。

* 性能
  代表参数：响应时间、吞吐量；设计策略：有限队列、资源调度

* 可靠性
  代表参数：MTTF、MTBF ；设计策略：冗余、心跳线
  MTTF 平均无故障时间
  MTBF 平均故障间隔时间

* 可用性 （**默认可用性。选择题**）
  代表参数：故障间隔时间； 设计策略：冗余、心跳线
 
* 安全性
  设计策略：追踪审计

* 可修改性
  主要策略： 信息隐藏


#### 架构评估

* 风险点：系统架构风险是指架构设计中潜在的，存在问题的架构决策所带来的隐患
* 敏感点：是指为了实现某种特定的质量属性，一个或多个构件所具有的特性。
* 权衡点：是影响多个质量属性的特征，是多个质量属性的敏感点
  **安全级别调整是权衡点**
  **权衡点是敏感点的一种特殊形式**

总结：用例描述功能需求，场景描述非功能需求

#### 软件架构评估 -ATAM
  ATAM分为四个主要的活动领域（或阶段），分别是**场景和需求收集、体系结构视图和场景实现、属性模型构造和分析、折中**。
 * ATAM
   ATAM分为四个主要的活动领域（或阶段），分别是**场景和需求收集、体系结构视图和场景实现、属性模型构造和分析、
 折中**。SAAM分析评估体系结构的过程中包括五个步骤，即**场景开发、体系结构描述、场景交互和总体评估**。SAAM的主要输入问题是
 **问题描述、需求说明和体系结构描述**。
 
 SAAM分析评估体系结构的过程中包括五个步骤，**场景开发、体系结构描述、场景交互和总体评估**。
 SAAM的主要输入是**问题描述、需求说明和体系结构描述**。
   加密子系统的机密级别会对安全性和性能产生异响，一般而言，加密程度越高，安全性越好，但是性能会降低；
 而加密程度越低，安全性越差，但性能一般会提高，因此该子系统将在 安全性和心梗两个方面产生冲突，所以盖子系统一定属于权衡点和敏感点。
 
#### 中间件技术-概念

 
### WEB 架构设计

#### 产品线基本概念

* 建立方式
  * 演化方式 （基于现有产品，全新产品）
  * 革命方式 （基于现有产品，全新产品）
  
### DSSA 特定领域软件体系
定义：特定领域软件架构可以看做开发产品线的一个方法理论、他的目标就是支持再一个特定领域中多个应用生成

特征：
1、一个严格定义的问题域或解决域
2、具有普遍性，使其可以用于领域中某一个特定应用的开发
3、对整个领域的适合程度的抽象
4、具备该领域固定的、定型的在开发过程中的可复用元素

* 特定领域架构架构设计过程，答题案例（案例分析）
  张工在创建该系统架构的过程中需要遵循特定领域架构的创建过程，创建过程主要包括：定义领域范围、定义领域元素、定义特定领域的设计和实现约束、
定义领域模型的架构、生产、收集可复用的产品单元。并且在这个过程中这些步骤是可以并发的、递归的、反复的、螺旋型的。
   1、定义领域范围：在此阶段的目的是划分问题是否属于烟草行业，以及本过程何时结束。最后属于烟草行业中的应用需求来满足用户的一系列需求。
   2、定于领域特定元素：本阶段的目标是编译领域字典和领域属于同义词字典，目标是为了输出属于烟草行业的字典。
   3、定义特定领域的设计和实现约束：本阶段的目标是描述空间中由差别的特征，不仅要识别出约束，并且要记录约束中对应的实现和决定造成的后果，
   还要记录处理这些问题所产生有问题的结论。
   4、定义特定领域的机构：本阶段的目标是为了产生系统的架构，并且说明他们的模块或者系统构件的定义。
   5、生产、收集可复用的产品单元：本阶段的目标是DSSA增加构件使得能够满足生产中产生问题的新运用。




### 软件架构风格
* 现代编译器
* **软件架构风格是描述某一特定应用领域汇总系统组织的惯用模式**。架构风格定义了一个系统家族，即一个**架构定义一个词汇表和一组约束**。词汇表中包含了
一些构件和连接件类型，而这组约束支出系统是如何将这些构件和连接件组合起来的，架构风格反映了领域中众多系统所共有的**结构和语义**特征，并指导如何将各个
模块和子系统有效地组织成一个完成的系统。对软件架构风格的研究和实践促进对设计的重用，一些经过实践证明的解决方案也可以可靠的地用于解决新的问题，例如。
某个人把系统描述为：“客户/服务器”模式，则不必给出设计细节，我们立刻回明白系统是如何组织和工作的
* “管道-过滤器” 
* “顺序批处理”， 强调一个整体
* 分布式架构
  * 分布式表示结构，应用逻辑层、数据处理层和数据层依然保留在服务器上，表示层和表示逻辑层迁移到客户机。
  * 分布式数据架构，数据层上和数据处理层放在服务器上，应用逻辑层、表示逻辑层和表示层放在客户机。
  * 分布式是数据和应用架构，数据层和数据处理层**数据服务器**上，应用逻辑层放在**应用服务器**上，表示层和表示逻辑层放在客户机上。
* 仓库风格
  * 剪贴板是用来存储带传递和交换的公共区域，这种机制成了一个共享仓库，所以属于以数据为中心的架构风格。


## 基于架构的软件开发方法
   基于架构的软件设计（ABSD）强调由商业、质量和功能需求的组合驱动软件架构设计。使用ABSD方法，设计活动可以从项目总体功能框架
 明确就开始，并且设计活动的开始并不意味着需求抽取和分析活动可以终止，而是应该与设计活动并行，
 ABSD方法有3个基础：第一个基础是**功能分解，
 在功能分解中使用已有的基于木块的内聚和耦合技术。第二个基础是通过选择体系结构风格来实现质量和商业需求。第三个基础是软件模板的使用。
 
 ABSD方法是一个自顶向下，递归细化的过程，软件系统的架构通过该方法得到细化，知道能够产生软件构件的类
 
 基于鱼软件架构的设计（ARchitecture Based SoftWare Development, ABSD）强调商业、质量和功能需求的组合驱动软件架构设计。
它强调采用 **视角于视图** 描述软件架构 ， 采用 **用例与质量场景** 描述需求。
